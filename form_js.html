<script> 
google.script.run.withSuccessHandler(getMaladaptives).getMaladaptives()

GlobalData = function(){
  clientID = ''
  function setCID(i){
    clientID = i;
  }
  function getCID(){
    return clientID;
  }
  return{
    setClientID:setCID,
    getClientID:getCID
  }
}();

Maladaptives = function(){
  mal = ''
  sel = {}
  function set(o){
    mal = o
    maladaptiveScript(mal);
  }
  function selected(o){
    sel[o.params.data.text] = o.params.data
  }
  function allSelected(o){
    sel = o;
  }
  function removeSel(o){
    delete sel[o.params.data.text]
  }
  function get(){
    return mal
  }
  function getSel(){
    return sel
  }
  return{
    setAll:set,
    setSel:selected,
    setAllSel: allSelected,
    removeSel:removeSel,
    getAll:get,
    getSel:getSel
  }
}();

function getMaladaptives(list){
  let o = removeEmpty(list)
  let obj = o.sort(compareThirdColumn)
  Maladaptives.setAll(obj)
//  console.log(Maladaptives.getAll())
}

function compareThirdColumn(a, b) {
    if (a[3] === b[3]) {
        return 0;
    }
    else {
        return (a[3] < b[3]) ? -1 : 1;
    }
}

function removeEmpty(o){
  var list = []
  for(x of o){
    if(x[3] != '')
      list.push(x)
  }
  return list
}

/*
 *  Function to convert form objects to javascript object
 */

  $.fn.getFormObject = function() {
    var object = $(this).serializeArray().reduce(function(obj, item) {
        var name = item.name.replace("[]", "");
        if ( typeof obj[name] !== "undefined" ) {
            if ( !Array.isArray(obj[name]) ) {
                obj[name] = [ obj[name], item.value ];
            } else {
               obj[name].push(item.value);
            }
        } else {
            obj[name] = item.value;
        }
        return obj;
    }, {});
    return object;
}

/*
 *Calculate Age Function
 */

function getAge(birth, event) {
    var dob = new Date(birth);
    var e = new Date(event);
    var age = e.getFullYear() - dob.getFullYear();
    var m = e.getMonth() - dob.getMonth();
    if (m < 0 || (m === 0 && e.getDate() < dob.getDate())) {
        age--;
        m = 12-(Math.abs(m))
    }
    return [age, m];
}

/*
 *  Functions to automatically fill Age at Assessment && Age of Diagnosis when they user focuses out of date input
 */

$("#DOD").focusout(function(){
  let x = getAge($('#DOB').text(), $("#DOD").val())
//  alert( $('#DOB').text() + "\n"  + $("#DOD").val())
  $('#CAAD').val(x[0] + ' years, ' + x[1] + ' months')
});

$("#DIAA").focusout(function(){
  let x = getAge($('#DOB').text(), $("#DIAA").val())
//  alert( $('#DOB').text() + "\n"  + $("#DOD").val())
  $('#AAA').val(x[0] + ' years, ' + x[1] + ' months')
});

/*
 *  Function to create the session schedule table. Take values from Start Time input and End Time input.
 */


$(document).on('click', '#createSchedule', setSchedule); 

//$(document).ready(function(){
//  $("#Session End Time").change(setSchedule);
//});

function setSchedule(){ 
  var tableHeaderRowCount = 1;
  var table = document.getElementById('Proposed Session Schedule')
  var rowCount = table.rows.length;
  for (var i = tableHeaderRowCount; i < rowCount; i++) {
    table.deleteRow(tableHeaderRowCount);
  }
  
  var s = document.getElementById('Session Start Time').value
  var e = document.getElementById('Session End Time').value
  
  var intervals = parseTime(s, e)
  if(intervals == 'Start Time cannot be later than of equal to End Time!'){
    alert(intervals);
    }
  else{
    var i = 0;
    for(interval of intervals){
    var row = table.insertRow(-1)
    
    var cell1 = row.insertCell(0)
    var cell2 = row.insertCell(1)
    
    cell1.innerHTML = "<textarea id='PSS"+ i +"Time' rows=1 style='width:99%' name='PSS" + i + "Time'>" + interval[0] + " - " + interval[1] +" </textarea>"
    cell2.innerHTML = "<textarea id='PSS" + i + "Outline' style='width:99%' rows=6 name='PSS" + i + "Outline' title='Example: \n\nGreetings/Check-In: Greet X and his/her family members. Check in with X’s parents in order to identify how X’s day has been so far, determine if there have been any significant life-changing events, issues, changes, or parent/caregiver parent concerns." + 
    "\nPriming: Set-up X’s visual session schedule and review it with X."+
    "\nSession Set-Up: Gather X’s ABA Program Binder; individualized skill acquisition programs; individualized BSP; ABA program visuals, ABA program materials, and ABA program data sheets. Set up for skill acquisition program implementation."+
    "\nTransition: Prompt/Direct X to his/her designated ABA program work area in X.'></textarea>" 
    i++
    }
  }
}

/*
 *  Parse start and end inputs into 30 minute interval sets
 */

function parseTime(s,e) {	
//Parse Start Time
  var startHours = Number(s.match(/^(\d+)/)[1]);
  var startMinutes = Number(s.match(/:(\d+)/)[1]);
  var startAMPM = s.match(/\s(.*)$/)[1];
//Parse End Time
  var endHours = Number(e.match(/^(\d+)/)[1]);
  var endMinutes = Number(e.match(/:(\d+)/)[1]);
  var endAMPM = e.match(/\s(.*)$/)[1];
  
 //Add 12 or subtract 12 if AM or PM
  if(startAMPM.toLowerCase() == "pm" && startHours<12) startHours = startHours+12;
  if(startAMPM.toLowerCase() == "am" && startHours==12) startHours = startHours-12;
  
  if(endAMPM.toLowerCase() == "pm" && endHours<12) endHours = endHours+12;
  if(endAMPM.toLowerCase() == "am" && endHours==12) endHours = endHours-12;
  
  
  if(startHours > endHours || (startHours == endHours && startMinutes >= endMinutes)){
    return 'Start Time cannot be later than of equal to End Time!'
  }
  else{
    var timesInBetween = []
    if(startMinutes == 30){
      timesInBetween.push([startHours < 10 ? tConvert("0" + startHours+":"+startMinutes) : tConvert(startHours+":"+startMinutes), startHours < 10 ? tConvert("0" + (startHours + 1) + ":" + "00") : tConvert((startHours + 1) + ":" + "00")])
      startHours++;
      }
      
    for(var i = startHours; i < endHours; i++){
      timesInBetween.push([i < 10 ? tConvert("0" + i + ":00") : tConvert(i + ":00"),i < 10 ? tConvert("0" + i + ":30") : tConvert(i + ":30")])
      timesInBetween.push([i < 10 ? tConvert("0" + i + ":30") : tConvert(i + ":30"),i < 10 ? tConvert("0" + (i+1) + ":00") : tConvert((i+1) + ":00")])
    }
    i = endHours
    if(endMinutes == 30){
      timesInBetween.push([endHours < 10 ? tConvert("0" + endHours+":"+ "00") : tConvert(endHours + ":" + "00"), endHours < 10 ? tConvert("0" + (endHours) + ":" + endMinutes) : tConvert((endHours) + ":" + endMinutes)])
      startHours++;
      }
  }
  return timesInBetween
}

/*
 *  Convert 12Hr string values to 24Hr format
 */

function tConvert (time) {
  // Check correct time format and split into components
  time = time.toString ().match (/^([01]\d|2[0-3])(:)([0-5]\d)(:[0-5]\d)?$/) || [time];

  if (time.length > 1) { // If time format correct
    time = time.slice (1);  // Remove full string match value
    time[5] = +time[0] < 12 ? 'AM' : 'PM'; // Set AM/PM
    time[0] = +time[0] % 12 || 12; // Adjust hours
  }
  return time.join (''); // return adjusted time or original string
}

/*
 *  Test function to email people via typed text strings
 */

  function emailTag(){
    var text= $("#IAAPB").val()
    google.script.run.tag(text)
  }
  
/*
 *  Function to maintain alerted/bookmarked tabs and scroll through the collection
 */
  
  var alertIterator = 0;
  var alerts;
  
  function myAlerts(){
    alerts = document.getElementsByClassName('missingInfo')
    if(alerts.length > 0){
      if((alertIterator) < alerts.length){
        alerts[alertIterator].scrollIntoView({behavior:"smooth"});
        alertIterator++;
      }
      else{
        alertIterator = 1;
        alerts[0].scrollIntoView({behavior:"smooth"});
      }
    }
  }

  function setMissing(element){
    element.classList.add("missingInfo");
  }
  
  function removeMissing(element){
    element.classList.remove("missingInfo");
  }

 //=================================================================================================================================================================
 //-----------------------------------Prefill Basic Client Info-----------------------------------------------------------------------------------------------------
 //=================================================================================================================================================================

  google.script.url.getLocation(function(location) {
    var clientID = location.parameters.clientID[0];
    GlobalData.setClientID(clientID);
//    google.script.run.withSuccessHandler(clientPrefill).getClientInfo(undefined, clientID);
    google.script.run.withSuccessHandler(clientPrefill).getInfo(clientID);
    google.script.run.withSuccessHandler(getLogs).getLogs(clientID);
    google.script.run.withSuccessHandler(setUser).getUser();
  });

function setUser(user){
  username = user;
  Reviewer.setWri(user);
}

/*
 * Get coordination of care logs from database and fill table
 */
 
function getLogs(logs){
  var table = document.getElementById('commLog')
  for(provider in logs){
  console.log(logs[provider])
    if(logs[provider].length > 1 ){
    // Create an empty <tr> element and add it to the 1st position of the table:
    var row = table.insertRow(1);
    
    // Insert new cells (<td> elements) at the 1st and 2nd position of the "new" <tr> element:
    var cell1 = row.insertCell(0);
    var cell2 = row.insertCell(1);
    var cell3 = row.insertCell(2);
    
    // Add some text to the new cells:
    cell1.innerHTML = logs[provider][1]['EntityContacted'];
    cell2.innerHTML = logs[provider][1]['DateOfComm'];
    cell3.innerHTML = logs[provider][1]['CommNote'];
    }
    else{
    // Create an empty <tr> element and add it to the 1st position of the table:
    var row = table.insertRow(-1);
    row.classList.add('empty')
    
    // Insert new cells (<td> elements) at the 1st and 2nd position of the "new" <tr> element:
    var cell1 = row.insertCell(0);
    var cell2 = row.insertCell(1);
    var cell3 = row.insertCell(2);
    
    // Add some text to the new cells:
    cell1.innerHTML = logs[provider][0];
    cell2.innerHTML = '--';
    cell3.innerHTML = '--';
    }
    
  }
}

/*
 *  Populate maladaptive behavior checklist and add functionality onclick 
 */
 
 // In your Javascript (external .js resource or <script> tag)
$(document).ready(function() {
    $('.js-example-basic-multiple').select2({
        width: 'resolve', // need to override the changed default
        maximumSelectionLength: 5,
        placeholder: "Maladaptive Behaviors",
        allowClear: true,
        tags: true,
        insertTag: function (data, tag) {
        // Insert the tag at the end of the results
          data.push(tag);
          },
        createTag: function (params) {
          var term = $.trim(params.term);
        
          if (term === '') {
            return null;
          }
          
          return {
            id: term,
            text: term,
            newTag: true // add additional parameters
          }
        }
    });
});

    $('#MaladaptiveSelect').on('select2:select', function(e){
      Maladaptives.setSel(e);
      var data=e.params.data;
      console.log(Maladaptives.getSel());
      var value = data.text
      var id = data.id
      
      
    //Display behavior and description
      var desc = document.getElementById('descriptionTable')
      var row = desc.insertRow(-1);
      var cell1 = row.insertCell(0);
      cell1.innerHTML = value
      
      var cell2 = row.insertCell(1);
      if(data.hasOwnProperty('newTag') && data.newTag == true){
        cell2.innerHTML = "<textarea id='" + value + "description' name='" + value + "description' style='width:99%;'></textarea>";
      }
      else{
        cell2.innerHTML = data.title;
      }
    
    //Create row in behavior score table
        var clientName = document.getElementById('ClientName').textContent;
        var malTable = document.getElementById('malTable');
        var row = malTable.insertRow(-1);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);
        var cell5 = row.insertCell(4);
        cell1.innerHTML = value;
        cell2.innerHTML = "<input type=number id='"+ value + "FreqScore' name='"+ value + "FreqScore'>";
        cell3.innerHTML = "<input type=number id='"+ value + "IntensityScore' name='"+ value + "IntensityScore'>";
        cell4.innerHTML = "<input type=number id='"+ value + "DurationScore' name='"+ value + "DurationScore'>";
        cell5.innerHTML = "<input type=number id='"+ value + "DiscriminationScore' name='"+ value + "DiscriminationScore'>";
    
     //Create row in hypothesized functions table
        var malTable2 = document.getElementById('malTable2');
        var rowt2 = malTable2.insertRow(-1);
        var cellt21 = rowt2.insertCell(0);
        var cellt22 = rowt2.insertCell(1);
        cellt21.innerHTML = value;
        cellt22.innerHTML = "<textarea rows=1 id='"+ id + "HF' name='"+ value + "HF' style='width:99%;'></textarea>";
        
         //Create BEH Reduction Goal
         if($('input[name=ReportType]').val() == "Initial Client ABA Assessment/Initial Client ABA Treatment Plan Template"){
        $("#BEHData").append("<div class=basic id='"+id+"BEH'>"+
                               "<div class=head>"+
                                 "<p><strong>"+ value +"</strong></p>"+
                               "</div>"+
                               "<div class=med id='skillAcqGoal"+id+"'>"+
                                 "<table>"+
                                   "<col width=15%>"+
                                   "<col width=85%>" +
                                   "<tr>"+
                                     "<td> Goal Type: </td>"+
                                     "<td>New Goal</td>"+
                                   "</tr>" +
                                   "<tr>"+
                                     "<td> Goal Category </td>"+
                                     "<td style='padding: 0;'><input type=text name='"+value+"Category value='Behavior Reduction Goal'</td>"+
                                   "</tr>" +
                                   "<tr>"+
                                     "<td> Goal: </td>"+
                                     "<td><input type=text name='"+value+" Goal'></td>"+
                                   "</tr>"+
                                   "<tr>"+
                                     "<td> Objective 1: </td>"+
                                     "<td><input type=text name='"+value+" Objective 1'></td>"+
                                   "</tr>"+
                                   "<tr>"+
                                     "<td> Objective 2: </td>"+
                                     "<td><input type=text name='"+value+" Objective 2'></td>"+
                                   "</tr>"+
                                   "<tr>"+
                                     "<td> Objective 3: </td>"+
                                     "<td><input type=text name='"+value+" Objective 3'></td>"+
                                   "</tr>"+
                                   "<tr>"+
                                     "<td> Objective 4: </td>"+
                                     "<td><input type=text name='"+value+" Objective 4'></td>"+
                                   "</tr>"+
                                   "<tr>"+
                                     "<td> Mastery Criteria: </td>"+
                                     "<td><input type=text name='"+value+" Mastery Criteria'></td>"+
                                   "</tr>"+
                                   "<tr>"+
                                     "<td> Maintenance Mastery Criteria: </td>"+
                                     "<td><input type=text name='"+value+" Maintenance Mastery Criteria'></td>"+
                                   "</tr>"+
                                   "<tr>"+
                                     "<td> Start Date: </td>"+
                                     "<td><input type=text name='"+value+" Start Date'></td>"+
                                   "</tr>"+
                                   "<tr>"+
                                     "<td> Mastery Target Date: </td>"+
                                     "<td><input type=text name='"+value+" Mastery Target Date'></td>"+
                                   "</tr>"+
                                   "<tr>"+
                                     "<td> Initial Baseline: </td>"+
                                     "<td><input type=text name='"+value+" Initial Baseline'></td>"+
                                   "</tr>"+
                                   "<tr>"+
                                     "<td> Baseline: </td>"+
                                     "<td><input type=text name='"+value+" Baseline'></td>"+
                                   "</tr>"+
                                   "<tr>"+
                                     "<td> Objectives Mastered: </td>"+
                                     "<td><input type=text name='"+value+" Objectives Mastered'></td>"+
                                   "</tr>"+
                                   "<tr>"+
                                     "<td> Total Mastered Targets: </td>"+
                                     "<td><input type=text name='"+value+" Total Mastered Targets'></td>"+
                                   "</tr>"+
                                   "<tr>"+
                                     "<td> Generalization Planning/Programming: </td>"+
                                     "<td><input type=text name='"+value+" Generalization Planning/Programming'></td>"+
                                   "</tr>"+
                                   "<tr>"+
                                     "<td> Current Progress Status: </td>"+
                                     "<td style='padding: 0;'><select name='goalStatus' style='width: 100%; height: 46px;' onchange='mastered(this, behreasonMastered"+this.id+")'><option value='Goal Discontinued'>Goal Discontinued</option><option value='No Progress'>No Progress</option><option value='Minimal Progress'>Minimal Progress</option><option value='Moderate Progress'>Moderate Progress</option><option value='Significant Progress'>Significant Progress</option><option value='Goal Mastered'>Goal Mastered</option></select></td>"+
                                   "</tr>"+
                                   "<tr id='behreasonMastered"+id+"'>"+
                                     "<td> Reason for Not Meeting Goal:</td>"+
                                     "<td style='padding: 0;'><textarea style='width: 99%; height: 46px;'></textarea></td>"+
                                   "</tr>"+
                                   "<tr>"+
                                     "<td> Recommended for Continued Treatment: </td>"+
                                     "<td style='padding: 0;'><select name='ContinuedTreatment' style='width: 100%; height: 46px;' onchange='recommended(this, behreasonRecommended"+this.id+")'><option value='No'>No</option><option value='Yes'>Yes</option></select></td>"+
                                   "</tr>"+
                                   "<tr id='behreasonRecommended"+id+"'>"+
                                   "<td> Reason for Not Recommending for Continued Treatment: </td>"+
                                   "<td style='padding: 0;'><textarea style='width: 99%; height: 46px;'></textarea></td>"+
                                   "</tr>"+
                                 "</table>"+
                               "</div>"+
                             "</div>")
                             }
                             //Create Identified Antecedents & Consequences List
                             var ACContainer = document.getElementById('A&CContainer');
                             ACContainer.innerHTML += "<div id='"+id+"A&C' class=basic>"+
                                   "<h4><u> " + value +"</u></h4>"+
                                   "<p><strong>Antecedents that have been identified as initiating " + clientName +"'s emission of " + value + " are as follows: </strong></p>"+
                                     "<input id'="+id+"A1' value='When certain types of tasks/request are presented to "+clientName+"' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A1'> When certain types of tasks/request are presented to "+clientName+"</label><br>"+
                                     
                                     "<input id='"+id+"A2' value='When easy tasks/request are presented to "+clientName+"' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A2'> When easy tasks/request are presented to "+clientName+"</label><br>"+
                                     
                                     "<input id='"+id+"A3' value='When difficult tasks/request are presented to "+clientName+"' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A3'> When difficult tasks/request are presented to "+clientName+"</label><br>"+
                                     
                                     "<input id='"+id+"A4' value='When particular tasks/activities are presented to "+clientName+"' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A4'> When particular tasks/activities are presented to "+clientName+"</label><br>"+
                                     
                                     "<input id='"+id+"A5' value='When new/novel tasks/activities are presented to "+clientName+"' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A5'> When new/novel tasks/activities are presented to "+clientName+"</label><br>"+
                                     
                                     "<input id='"+id+"A6' value='When tasks/requests are presented to "+clientName+" during an ongoing activity' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A6'> When tasks/requests are presented to "+clientName+" during an ongoing activity</label><br>"+
                                     
                                     "<input id='"+id+"A7' value='When "+clientName+" is asked to start a certain task/activity' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A7'> When "+clientName+" is asked to start a certain task/activity</label><br>"+
                                     
                                     "<input id='"+id+"A8' value='When "+clientName+" is asked to stop a certain task/activity' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A8'> When "+clientName+" is asked to stop a certain task/activity</label><br>"+
                                     
                                     "<input id='"+id+"A9 value='When a disruption occurs in "+clientName+"\’s normal/typical routine\' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A9'> When a disruption occurs in "+clientName+'\’s normal/typical routine</label><br>'+
                                     
                                     "<input id="+id+"A10' value='When a specific person is present within the room/setting' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A10'> When a specific person is present within the room/setting</label><br>"+
                                     
                                     "<input id='"+id+"A11' value='When a specific person is absent within the room/setting' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A11'> When a specific person is absent within the room/setting</label><br>"+
                                     
                                     "<input id='"+id+"A12' value='When a specific person attempts to interact with "+clientName+"' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A12'> When a specific person attempts to interact with "+clientName+"</label><br>"+
                                     
                                     "<input id='"+id+"A13' value='When a specific person delivers a specific request/demand to "+clientName+"' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A13'> When a specific person delivers a specific request/demand to "+clientName+"</label><br>"+
                                     
                                     "<input id='"+id+"A14' value='When "+clientName+" is not feeling well/When " + clientName +"is feeling ill' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A14'> When "+clientName+" is not feeling well/When " + clientName +"is feeling ill</label><br>"+
                                     
                                     "<input id='"+id+"A15' value='During teaching/training activities' type=checkbox>"+
                                     "<label for='"+id+"A15'> During teaching/training activities</label><br>"+
                                     
                                     "<input id='"+id+"A16' value='When "+clientName+" has not received much attention/When attention is withheld or removed from " + clientName +"' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A16'> When "+clientName+" has not received much attention/When attention is withheld or removed from " + clientName + "</label><br>"+
                                     
                                     "<input id='"+id+"A17' value='When "+clientName+" is denied access to preferred items and activities' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A17'> When "+clientName+" is denied access to preferred items and activities</label><br>"+
                                     
                                     "<input id='"+id+"A18' value='When non-preferred demands, instructions, activities, or requests are presented to "+clientName+"' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A18'> When non-preferred demands, instructions, activities, or requests are presented to "+clientName+"</label><br>"+
                                     
                                     "<input id='"+id+"A19' value='When "+clientName+" is in the presence of others' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A19'> When "+clientName+" is in the presence of others</label><br>"+
                                     
                                     "<input id='"+id+"A20' value='Immediately after someone interacts with "+clientName+"  (delivers an instruction or reprimand to " + clientName +", walks away from or ignores " + 
                                                                                   clientName + "takes away a preferred item or activity from " + clientName + ",or requires " + clientName +" to change activities)' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A20'> Immediately after someone interacts with "+clientName+"  (delivers an instruction or reprimand to " + clientName +", walks away from or ignores " + 
                                                                                   clientName + " takes away a preferred item or activity from " + clientName + ", or requires " + clientName +" to change activities)</label><br>"+
                                                                                   
                                     "<input id='"+id+"A21' value='When "+clientName+" is denied a request' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A21'> When "+clientName+" is denied a request</label><br>"+
                                     
                                     "<input id='"+id+"A22' value='When "+clientName+" is told it is time to end a preferred activity' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A22'> When "+clientName+" is told it is time to end a preferred activity</label><br>"+
                                     
                                     "<input id='"+id+"A23' value='When "+clientName+" is in a noisy or crowded environment' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A23'> When "+clientName+" is in a noisy or crowded environment</label><br>"+
                                     
                                     "<input id='"+id+"A24' value='When "+clientName+" is left alone for long periods of time/When "+ clientName +" is alone, bored, or unoccupied' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A24'> When "+clientName+" is left alone for long periods of time/When "+ clientName +" is alone, bored, or unoccupied</label><br>"+
                                     
                                     "<input id='"+id+"A25' value='When attention is being be provided to other people in "+clientName+ "\’s immediate environment\' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A25'> When attention is being be provided to other people in "+clientName+ "\’s immediate environment</label><br>"+
                                     
                                     "<input id='"+id+"A26' value='The behavior occurs at relatively high rates regardless of what is going in the immediate environment' type=checkbox name='" + value + "Antecedent'>"+
                                     "<label for='"+id+"A26'> The behavior occurs at relatively high rates regardless of what is going in the immediate environment</label><br><br><br>"+
                                     
                                     "<p><strong> Identified consequences that appear to be maintaining " + clientName + "'s emission of " + value + " are as follows: </strong></p>" +
                                     "<input id='"+id+"C1' value='Escape, Avoidance, or Delay' type=checkbox name='" + value + "Consequences'>"+
                                     "<label for='"+id+"C1'> Escape, Avoidance, or Delay</label><br>"+
                                     
                                     "<input id='"+id+"C2' value='Sensory Stimulation' type=checkbox name='" + value + "Consequences'>"+
                                     "<label for='"+id+"C2'> Sensory Stimulation</label><br>"+
                                     
                                     "<input id='"+id+"C3' value='Tasks, Demands & Activities' type=checkbox name='" + value + "Consequences'>"+
                                     "<label for='"+id+"C3'> Tasks, Demands & Activities</label><br>"+
                                     
                                     "<input id='"+id+"C4' value='Tangible Items & Objects' type=checkbox name='" + value + "Consequences'>"+
                                     "<label for='"+id+"C4'> Tangible Items & Objects</label><br>"+
                                     
                                     "<input id='"+id+"C5' value='Attention' type=checkbox name='" + value + "Consequences'>"+
                                     "<label for='"+id+"C5'> Attention</label><br>"+
                                     
                                     "<p><strong>   Access to: </strong></p>"+
                                     "<input id='"+id+"C6' value='Sensory Stimulation' type=checkbox name='" + value + "Access'>"+
                                     "<label for='"+id+"C6'> Sensory Stimulation</label><br>"+
                                     
                                     "<input id='"+id+"C7' value='Tasks, Demands, & Activities' type=checkbox name='" + value + "Access'>"+
                                     "<label for='"+id+"C7'> Tasks, Demands, & Activities</label><br>"+
                                     
                                     "<input id='"+id+"C8' value='Tangible Items & Objects' type=checkbox name='" + value + "Access'>"+
                                     "<label for='"+id+"C8'> Tangible Items & Objects</label><br>"+
                                     
                                     "<input id='"+id+"C9' value='Attention' type=checkbox name='" + value + "Access'>"+
                                     "<label for='"+id+"C9'> Attention</label><br>"+
                                     
                                     "<p> Identified Functionally Equivalent Replacement Skills to be Taught: </p>" +
                                     
                                     "<table class=shortTable><col width=7%><col width=93%>"+ 
                                       "<tr><th></th><th> Replacement Skills</th></tr>"+
                                       "<tr><td>1</td><td><textarea rows=1 style='width:99%' id='"+id+"Replace1' name='"+value+"Replace1'></textarea></td></tr>"+
                                       "<tr><td>2</td><td><textarea rows=1 style='width:99%' id='"+id+"Replace2' name='"+value+"Replace1'></textarea></td></tr>"+
                                       "<tr><td>3</td><td><textarea rows=1 style='width:99%' id='"+id+"Replace3' name='"+value+"Replace1'></textarea></td></tr>"+
                                       "<tr><td>4</td><td><textarea rows=1 style='width:99%' id='"+id+"Replace4' name='"+value+"Replace1'></textarea></td></tr>"+
                                       "<tr><td>5</td><td><textarea rows=1 style='width:99%' id='"+id+"Replace5' name='"+value+"Replace1'></textarea></td></tr>"+
                                     "</table>" + 
                                     "<table class=shortTable><col width=7%><col width=93%>"+ 
                                       "<tr><th></th><th> Frequency of X </th></tr>"+
                                       "<tr><td>1</td><td><label for='"+id+"Freq1'><strong>How often does the target behavior occur?</strong><br> 1=Every Month,7=Every Minute</label><input type='range' list='tickmarks' min='1' max='7'                              id='"+id+"Freq1' name='"+value+"Freq' onchange='appendixSum(this)'></td></tr>"+
                                       "<tr><td>2</td><td><label for='"+id+"Freq2'><strong>What times of day does the target behavior occur? </strong><br> 1=Specific Times of Day,7=All Times of Day</label><input type='range' list='tickmarks' min='1' max='7'       id='"+id+"Freq2' name='"+value+"Freq' onchange='appendixSum(this)'></td></tr>"+
                                       "<tr><td>3</td><td><label for='"+id+"Freq3'><strong>What times of month does the target behavior occur? </strong><br> 1=Specific Times of Month,7=All Times of Month</label><input type='range' list='tickmarks' min='1' max='7' id='"+id+"Freq3' name='"+value+"Freq' onchange='appendixSum(this)'></td></tr>"+
                                       "<tr><td>4</td><td><label for='"+id+"Freq4'><strong>What times of year does the target behavior occur?  </strong><br> 1=Specific Times of Year,7=All Times of Year</label><input type='range' list='tickmarks' min='1' max='7'   id='"+id+"Freq4' name='"+value+"Freq' onchange='appendixSum(this)'></td></tr>"+
                                     "<datalist id='tickmarks'><option value='0'></option><option value='1'></option><option value='2'></option><option value='3'></option><option value='4'></option> <option value='5'></option><option value='6'></option><option value='7'></option></datalist></table>" + 
                                    "<table class=shortTable><col width=7%><col width=93%>"+ 
                                       "<tr><th></th><th> Intensity of X </th></tr>"+
                                       "<tr><td>1</td><td><label for='"+id+"Int1'><strong>How severe is the physical damage to the client as a result of the target behavior?</strong><br> 1=No Element of Physical Damage to Self, 7=Life Threatening to Self</label><input type='range' list='tickmarks' min='1' max='7'     id='"+id+"Intensity1' name='"+value+"Int' onchange='appendixSum(this)'></td></tr>"+
                                       "<tr><td>2</td><td><label for='"+id+"Int2'><strong>How severe is the physical damage to others as a result of the target behavior?</strong><br> 1=No Element of Physical Damage to Other(s), 7=Life Threatening to Other(s)</label><input type='range' list='tickmarks' min='1' max='7' id='"+id+"Intensity2' name='"+value+"Int' onchange='appendixSum(this)'></td></tr>"+
                                       "<tr><td>3</td><td><label for='"+id+"Int3'><strong>How severe is the physical damage to the environment as a result of the target behavior? </strong><br> 1=No Damage to Environment, 7=Severe Property Damage</label><input type='range' list='tickmarks' min='1' max='7'              id='"+id+"Intensity3' name='"+value+"Int' onchange='appendixSum(this)'></td></tr>"+
                                       "<tr><td>4</td><td><label for='"+id+"Int4'><strong>How severe is the disruption to routines as a result of the target behavior?  </strong><br> 1=Does Not Interfere with Routines, 7= Severe Disruption to Routines</label><input type='range' list='tickmarks' min='1' max='7'         id='"+id+"Intensity4' name='"+value+"Int' onchange='appendixSum(this)'></td></tr>"+
                                     "<datalist id='tickmarks'><option value='0'></option><option value='1'></option><option value='2'></option><option value='3'></option><option value='4'></option> <option value='5'></option><option value='6'></option><option value='7'></option></datalist></table>" +
                                     "<table class=shortTable><col width=7%><col width=93%>"+ 
                                       "<tr><th></th><th> Duration of X </th></tr>"+
                                       "<tr><td>1</td><td><label for='"+id+"Dur1'><strong>How soon does the target behavior re-occur? </strong><br> 1=Days Later, 7=Right Away</label><input type='range' list='tickmarks' min='1' max='7'           id='"+id+"Duration1' name='"+value+"Dur' onchange='appendixSum()'></td></tr>"+
                                       "<tr><td>2</td><td><label for='"+id+"Dur2'><strong>How long does this target behavior last from start to finish? </strong><br> 1=Seconds, 7=Hours</label><input type='range' list='tickmarks' min='1' max='7' id='"+id+"Duration2' name='"+value+"Dur' onchange='appendixSum()'></td></tr>"+
                                       "<tr><td>3</td><td><label for='"+id+"Dur3'><strong>How long is the escalation leading up to the target behavior? </strong><br> 1=Seconds, 7=Hours</label><input type='range' list='tickmarks' min='1' max='7' id='"+id+"Duration3' name='"+value+"Dur' onchange='appendixSum()'></td></tr>"+
                                       "<tr><td>4</td><td><label for='"+id+"Dur4'><strong>How long is the de-escalation following the target behavior? </strong><br> 1=Seconds, 7=Hours</label><input type='range' list='tickmarks' min='1' max='7'  id='"+id+"Duration4' name='"+value+"Dur' onchange='appendixSum()'></td></tr>"+
                                     "<datalist id='tickmarks'><option value='0'></option><option value='1'></option><option value='2'></option><option value='3'></option><option value='4'></option> <option value='5'></option><option value='6'></option><option value='7'></option></datalist></table>" + 
                                    "<table class=shortTable><col width=7%><col width=93%>"+ 
                                       "<tr><th></th><th> Discrimination of X </th></tr>"+
                                       "<tr><td>1</td><td><label for='"+id+"Disc1'><strong>With whom does this target behavior occur?</strong><br> 1=With One Person Only, 7=Everyone</label><input type='range' list='tickmarks' min='1' max='7'                     id='"+id+"Disc1' name='"+value+"Dis' onchange='appendixSum()'></td></tr>"+
                                       "<tr><td>2</td><td><label for='"+id+"Disc2'><strong>Where does this target behavior occur (across settings)? </strong><br> 1=In One Setting, 7=All Settings</label><input type='range' list='tickmarks' min='1' max='7'        id='"+id+"Disc2' name='"+value+"Dis' onchange='appendixSum()'></td></tr>"+
                                       "<tr><td>3</td><td><label for='"+id+"Disc3'><strong>Where does this target behavior occur (within settings)?  </strong><br>  1=In One Area/Room, 7=Every Area/Room</label><input type='range' list='tickmarks' min='1' max='7' id='"+id+"Disc3' name='"+value+"Dis' onchange='appendixSum()'></td></tr>"+
                                       "<tr><td>4</td><td><label for='"+id+"Disc4'><strong>When does this target behavior occur? </strong><br> 1=In One Activity/Routine, 7 = Every Activity/Routine</label><input type='range' list='tickmarks' min='1' max='7'      id='"+id+"Disc4' name='"+value+"Dis' onchange='appendixSum()'></td></tr>"+
                                     "<datalist id='tickmarks'><option value='0'></option><option value='1'></option><option value='2'></option><option value='3'></option><option value='4'></option> <option value='5'></option><option value='6'></option><option value='7'></option></datalist></table>" +
                                  "</div>"

    });
    
    $('#MaladaptiveSelect').on('select2:unselect', function(e){
      Maladaptives.removeSel(e)
      var data=e.params.data;
      var value = data.text
        
        var desc = document.getElementById('descriptionTable')
        for(var i = 1; i < desc.rows.length; i++){
          if(desc.rows[i].cells[0].innerHTML == value){
//            alert('Unchecked ' + malTable.rows[i].cells[0].innerHTML);
            desc.deleteRow(i);}
          }
         
          //Delete entry from table
        var malTable = document.getElementById('malTable');
        for(var i = 1; i < malTable.rows.length; i++){
          if(malTable.rows[i].cells[0].innerHTML == value){
//            alert('Unchecked ' + malTable.rows[i].cells[0].innerHTML);
            malTable.deleteRow(i);}
          }
      //Delete entry from table2
        var malTable2 = document.getElementById('malTable2');
        for(var i = 1; i < malTable2.rows.length; i++){
          if(malTable2.rows[i].cells[0].innerHTML == value){
            malTable2.deleteRow(i);}
          }
       //Delete Identified Antecedents & Consequences List
         var id = data.id+"A&C"
         document.getElementById(id).remove();
         document.getElementById(data.id+"BEH").remove();
     });
     
  function maladaptiveScript(malList){
  //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
     //-------------------Create Maladaptive Behavior Checklist----------------------
     //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
            
  var malListSelect = document.getElementById('MaladaptiveSelect')
  
  for(var x = 0; x < malList.length; x++){
    var newOption = new Option(malList[x][3], malList[x][3], false, false)
    newOption.setAttribute('title', malList[x][4]);
    $('#MaladaptiveSelect')
              .append(newOption)
              .trigger('change')
              
  }


  var malListDiv = document.getElementById('MaladaptiveList');
  
  var symptomologyList=['is lacking basic social, emotional, and communication skills and emits a variety of non-functional, maladaptive behaviors. ','does not consistently respond to their name',
                     'does not point at or towards toys, items, or objects to demonstrate interest','does not look in the direction of a toy, item, or object when another person points at or towards a toy, item, or object; has trouble relating to other people',
                     'may not have any interest in other people at all at times', 'does not consistently make eye contact with other people', 'will often avoid making eye contact with other people',
                     'typically prefers to be alone', 'typically prefers to play alone', 'has trouble recognizing, understanding, and talking about other people’s feelings', 'has trouble recognizing, understanding, and talking about their own feelings',
                     'prefers not to be held or cuddled', 'may only cuddle when they want to', 'frequently appears to be unaware when other people talk to them but will often respond to other environmental stimuli, such as sounds', 
                     'may be interested in people at times, but does not know how to talk, play, or relate to them', 'will often repeat or echo words or phrases said to them in place of using typical language', 'has trouble expressing their needs using typical words, gestures, or motions',
                     'does not play “pretend” games', 'will often repeat actions over and over again', 'has trouble adapting when minor changes are made to their normal routine or schedule', 
                     'frequently has unusual reactions to the way things smell, taste, look, feel, or sound', 'has difficulty providing related answers to questions asked to them', 
                     'exhibits narrow, extreme, or obsessive interests', 'engages in high rates of hand flapping behavior', 'engages in high rates of body rocking behavior', 'repeatedly spins their body in circles',
                     'engaged in high rates of other stereotypical behaviors', 'does not share their interests with other people', 'typically only interacts with other people in order to achieve a desired goal or outcome',
                     'exhibits flat facial expressions', 'exhibits inappropriate facial expressions', 'has difficulty understanding and respecting other people’s personal space and boundaries',
                     'is not easily comforted by others during times of distress or duress', 'exhibits delayed speech and language skills', 'often reverses pronouns when speaking, such as says “You” instead of “I"',
                     'emits few to no gestures in order to communicate basic wants, needs, and desires', 'talks using a flat, robot-like, and/or sing song voice', 'has difficulty recognizing and understanding jokes, sarcasm, and/or playful teasing made by other people',
                     'plays with toys in the same way each and every time', 'demonstrates extreme interest in specific parts of toys, items, or objects rather than toy, item, or object itself, such as shows an extreme interest in playing with the wheels on a toy car rather than the toy car itself',
                     'keeps toys, items, and objects nearby extremely organized', 'has to follow certain steps, rituals, or routines', 'easily loses skills they had once acquired']
  
  var treatmentList = ['Decrease Length of Tasks','Decrease Difficulty of Tasks','Non-Contingent Reinforcement (NCR)','Provide Functional Communication Training (FCT)',
                     'Provide Scheduled Access to Attention','Provide Scheduled Access to Preferred Items/Activities','Provide Scheduled Access to Sensory Stimulation/Sensory Activities',
                     'Provide Scheduled Breaks/Trade-Ins','Provide Frequent Review/Reminders of Behavior Expectations and Rules','Simply Tasks/Activities',
                     'Provide/Utilize Visuals Supports','Provide/Utilize Visual Schedules','Provide Clear Instructions','Set Clear Expectations & Rules',
                     'Utilize Behavioral Contracts','Utilize Behavioral Momentum','Provide Frequent Adult Check-ins',
                     'Provide Direct Instruction and Reinforcement for the Emission of Socially Appropriate Alternative Replacement Behaviors',
                     'Provide Frequent Movement Breaks','Provide Frequent Sensory Breaks',
                     'Provide Consistent and Clear Consequences for both Socially Appropriate and Socially Inappropriate Behaviors/Maladaptive Behaviors',
                     'Provide Choices as Frequently as Possible (Forced Choices)','Implement Extinction Procedures',
                     'Provide Behavioral Contracts and/or Tokens to Reinforce Socially Appropriate Behaviors, Attending Skills, and Participation',
                     'Provide Frequent Breaks, Trade-ins, Rewards/Reinforcers for Appropriate Behaviors','Conduct Preference Assessments on a Regular Basis',
                     'Provide/Utilize of Social Scripts/Social Stories','Provide a Highly Structured and Consistent Teaching Environment',
                     'Break Skills Taught Down into their Smallest Components','Provide Massed Opportunities for Practice',
                     'Implement One-to-One Direct Teaching Procedures, such as Discrete Trial Teaching (DTT)','Implement Errorless Learning Procedures',
                     'Implement Reinforced Learning Trial Procedures','Implement Systematic Prompting Procedures (Least-to-Most or Most-to-Least)',
                     'Implement Systematic Prompt Fading Procedures','Implement Priming Procedures','Limit Distractions','Program and Provide for the Generalization and Maintenance of all Skills']
  
    
  var instructionalMethodsList = ['Discrete Trial Training/Teaching (DTT)','Functional Communication Training (FCT)','Modeling','Natural Environment Training','Naturalistic Intervention (NI)',
                     'Parent Implemented Intervention (PII)','Peer Mediated Instruction and Intervention (PMI)','Picture Exchange Communication System','Pivotal Response Training (PRT)',
                     'Prompting','Reinforcement','Scripting','Social Skills Training','Social Stories/Social Narratives','Structured Play Group','Task Analysis (TA)','Technology Aide Instruction and Intervention (TAI)',
                     'Time Delay','Video Modeling','Visual Supports']
                                  
  var behavioralMethodsList = ['Antecedent Based Interventions','Consequence Based Interventions','Differential Reinforcement of Other Behavior (DRO)','Differential Reinforcement of Incompatible Behavior (DRI)',
                               'Differential Reinforcement of Alternative Behavior (DRA)','Extinction','Response Interruption (RI)','Response Redirection (RR)','Self-Management','Behavioral Momentum']

  var lists = [treatmentList,instructionalMethodsList,behavioralMethodsList, symptomologyList]
  var listString = ['maladaptiveBehavioralTreatment','instructionalMethods','behavioralMethods', 'Current Symptomology']
                                  
  var treatmentDiv = document.getElementById('treatmentList');
  var instructionalMethodsDiv = document.getElementById('instructionalMethodsChecklist');
  var behavioralMethodsDiv = document.getElementById('behavioralMethodsChecklist');
  var symptomologyDiv = document.getElementById('currSymptomology')
  var divs = [treatmentDiv,instructionalMethodsDiv,behavioralMethodsDiv, symptomologyDiv]
  
  for(var y=0; y<lists.length; y++){
    for(var x=0; x<lists[y].length; x++){
      var checkbox = document.createElement("input");
      var label = document.createElement("label");
      checkbox.type= "checkbox";
      checkbox.value= lists[y][x];
      checkbox.id= listString[y] + x;
      checkbox.name= listString[y];
      label.htmlFor= listString[y] + x;
      divs[y].appendChild(checkbox);
      divs[y].appendChild(label);
      label.appendChild(document.createTextNode(lists[y][x]));
      var linebreak = document.createElement('br');
      label.appendChild(linebreak);
    }
    }
    
    var time30 = ['5:00 AM', '5:30 AM', '6:00 AM','6:30 AM', '7:00 AM', '7:30 AM', '8:00 AM', '8:30 AM', '9:00 AM', '9:30 AM', 
    '10:00 AM', '10:30 AM', '11:00 AM', '11:30 AM', '12:00 PM', '12:30 PM', '1:00 PM', '1:30 PM', '2:00 PM', '2:30 PM', 
    '3:00 PM', '3:30 PM', '4:00 PM', '4:30 PM', '5:00 PM', '5:30 PM', '6:00 PM', '6:30 PM', '7:00 PM', '7:30 PM', '8:00 PM']
    
    for(var time of time30){
      var startSel = document.getElementById('Session Start Time');
      var endSel = document.getElementById('Session End Time');
      var opta = document.createElement('option');
      var optb = document.createElement('option');
      opta.appendChild( document.createTextNode(time) );
      optb.appendChild( document.createTextNode(time) );
      opta.value = time; 
      optb.value = time; 
      startSel.appendChild(opta); 
      endSel.appendChild(optb); 
    }
  }
  
  /*
   *  Add up maladaptive score
   */
  
  function appendixSum(a,b){
    let sum = 0;
    $("[name='"+a.name+"']").each(function() {
      sum += parseInt(this.value);
    });
    document.getElementById(a.name+'Score').value=sum
  }
  
  /*
   *  Fill known client info via database query
   */
  function clientPrefill(o){
  
    var doneLoading = false;

    var info = JSON.parse(o)
    for(data in info){
      var value = info[data]
      if(value == null){
        var element = document.getElementById(data)
        if(element != null){
          element.innerHTML = '<span style="background-color:Tomato"><strong>-</strong></span>'
          }
      }
      else if(data == 'Address1'){
        document.getElementById('Guardian1Add').innerHTML = '<strong>' + value + ' ' + info['City1'] +
                                                           ', '+ info['State1'] + ' ' + info['ZipCode1'] + '</strong>'; 
      }
      else if(data == 'Address2'){
        document.getElementById('Guardian2Add').innerHTML = '<strong>' + value + ' ' + info['City2'] +
        ', '+ info['State2'] + ' ' + info['ZipCode2'] + '</strong>'; 
        }
      else{
        var element = document.getElementById(data)
        if(element != null){
        element.innerHTML = '<strong>' + value +  '</strong>'; 
        }
      }
    }
    
    //Initialize load button after client info is loaded
    
    doneLoading = true; 

  var loadbtn = document.getElementById('loadBtn')
  
  if(doneLoading){
  loadbtn.disabled = false;  
  }
  
  loadbtn.onclick = function(){
    google.script.run.withSuccessHandler(getLastReport).getFunderSheetData(GlobalData.getClientID());
  }
}

/*
 *  Populate risk info when risk is selected
 */

function riskInfo(element,container, title, fam){
  if(element.checked == true){
    if( $("#"+container).is(":empty")){
      document.getElementById(container).innerHTML += '<h4><u>'+title+'</u></h4>' + 
                                           "<div class=head><p> Step #1: Warning Signs that a Crisis May be Developing (Thoughts, Images, Mood, Situation, Behavior) </p></div>" + 
                                             "<table class=shortTable>" + 
                                               "<col width=10%>"+
                                               "<col width=90%>"+
                                               "<tr><td> 1a </td><td><input type=text style='width: 99%' name='"+title+" Step1_1'></td></tr>" + 
                                               "<tr><td> 1b </td><td><input type=text style='width: 99%' name='"+title+" Step1_2'></td></tr>" +
                                               "<tr><td> 1c </td><td><input type=text style='width: 99%' name='"+title+" Step1_3'></td></tr>" +
                                             "</table>"+
                                           "<div class=head style='height: 55px'><p> Step #2: Internal Coping Strategies/Things the Child/Client Can Do W/Out Contacting Another Person (Relaxation Techniques, Physical Activity) </p></div>"+
                                             "<table class=shortTable>" + 
                                               "<col width=10%>"+
                                               "<col width=90%>"+
                                               "<tr><td> 2a </td><td><input type=text style='width: 99%' name='"+title+" Step2_1'></td></tr>" + 
                                               "<tr><td> 2b </td><td><input type=text style='width: 99%' name='"+title+" Step2_2'></td></tr>" +
                                               "<tr><td> 2c </td><td><input type=text style='width: 99%' name='"+title+" Step2_3'></td></tr>" +
                                             "</table>"+
                                           "<div class=head><p> Step #3: People & Social Settings that Provide a Distraction </p></div>"+
                                             "<table class=default>"+
                                               "<col width=100%>"+
                                               "<tr><td><textarea rows=2 style='width:99%;height:99%;' placeholder='(Name, Location)' name='"+title+" Step3_1'></textarea></td></tr>"+
                                               "<tr><td><textarea rows=2 style='width:99%;height:99%;' placeholder='(Name, Location)' name='"+title+" Step3_2'></textarea></td></tr>"+
                                               "<tr><td><textarea rows=2 style='width:99%;height:99%;' placeholder='(Name, Location)' name='"+title+" Step3_3'></textarea></td></tr>"+
                                             "</table>"+
                                           "<div class=head><p> Step #4: People Whom to Contact for Help </p></div>"+
                                             "<table class=default>"+
                                               "<col width=100%>"+
                                               "<tr><td><textarea rows=2 style='width:99%;height:99%;' placeholder='(Name, Location, & Phone #)' name='"+title+" Step4_1'></textarea></td></tr>"+
                                               "<tr><td><textarea rows=2 style='width:99%;height:99%;' placeholder='(Name, Location, & Phone #)' name='"+title+" Step4_2'></textarea></td></tr>"+
                                               "<tr><td><textarea rows=2 style='width:99%;height:99%;' placeholder='(Name, Location, & Phone #)' name='"+title+" Step4_3'></textarea></td></tr>"+
                                             "</table>"+
                                           "<div class=head><p> Step #5: Professionals & Agencies’ to Contact During a Crisis </p></div>"+
                                             "<table class=default>"+
                                               "<col width=100%>"+
                                               "<tr><td><textarea rows=2 style='width:99%;height:99%;' placeholder='(Clinician Name, Location, & Phone #)' name='"+title+" Step5_1'></textarea></td></tr>"+
                                               "<tr><td><textarea rows=2 style='width:99%;height:99%;' placeholder='(Clinician Name, Location, & Phone #)' name='"+title+" Step5_2'></textarea></td></tr>"+
                                               "<tr><td><textarea rows=2 style='width:99%;height:99%;' placeholder='(Clinician Name, Location, & Phone #)' name='"+title+" Step5_3'></textarea></td></tr>"+
                                             "</table>"+
                                           "<div class=head><p> Step #6: Making the Environment Safe </p></div>"+
                                             "<table class=default>"+
                                               "<col width=100%>"+
                                               "<tr><td><textarea rows=2 style='width:99%;height:99%;' placeholder='Remove Dangerous Items' name='"+title+" Step6_1'></textarea></td></tr>"+
                                               "<tr><td><textarea rows=2 style='width:99%;height:99%;' placeholder='Block/Redirect Physical Harm/Injury' name='"+title+" Step6_2'></textarea></td></tr>"+
                                               "<tr><td><textarea rows=2 style='width:99%;height:99%;' placeholder='Evade' name='"+title+" Step6_3'></textarea></td></tr>"+
                                             "</table>"
    }
  }
  else if(document.getElementById(fam+"PresentYes").checked !=true && document.getElementById(fam+"IdeationYes").checked !=true && document.getElementById(fam+"PlanYes").checked !=true && document.getElementById(fam+"MeansYes").checked !=true && document.getElementById(fam+"PriorYes").checked !=true ){
    $("#"+container).empty();
  }
}

  
 //=================================================================================================================================================================
 //-----------------------------------Scripts for Medical and Mental History Page-----------------------------------------------------------------------------------
 //=================================================================================================================================================================
 
     //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
     //-------------------------Medical Condition/Diagnosis--------------------------
     //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
 
 $(document).ready(function(){
   //Medical Diagnosis Table
   $("#medTableLengthConfirm").click(function(){
     var x = $("#medTableLength").val()
     var y = $("#medTable tr").length - 1;
     if(y < x){
       var z = x-y;
       for(var i = 0; i< z; i++){
       var h = $("#medTable tr").length;
       $('#medTable tr:last').after("<tr><td>" + h + "</td>"+
         "<td><textarea id='medTable" + h + "' style='width: 99%;' rows=2 name='Medical Condition/Diagnosis'> Medical Condition/Diagnosis " + h +"</textarea></td></tr>" );}
     }
     else if(y == x){}
     else{
       var z = y-x;
       for(var i=0; i < z; i++){
         $("#medTable tr:last").remove();
       }
     }
   });
   //Allergies Table
   $("#allergiesTableLengthConfirm").click(function(){
     var x = $("#allergiesTableLength").val()
     var y = $("#allergiesTable tr").length - 1;
     if(y < x){
       var z = x-y;
       for(var i = 0; i< z; i++){
       var h = $("#allergiesTable tr").length;
       $('#allergiesTable tr:last').after("<tr><td>" + h + "</td>"+
                                           "<td><textarea id='allergiesTable" + h + "' style='width: 99%;' rows=2 name='Allergies' placeholde='Allergy " + h +"'></textarea></td></tr>" );}
     }
     else if(y == x){}
     else{
       var z = y-x;
       for(var i=0; i < z; i++){
         $("#allergiesTable tr:last").remove();
       }
     }
   });
   //Current Medications Table
   $("#curMedTableLengthConfirm").click(function(){
     var x = $("#curMedTableLength").val()
     var y = $("#medicationsTable tr").length - 1;
     if(y < x){
       var z = x-y;
       for(var i = 0; i< z; i++){
       var h = $("#medicationsTable tr").length;
       $('#medicationsTable tr:last').after("<tr><td>" + h + "</td>"+
                                          "<td><textarea id='curMedTable" + h + "Col1' style='width: 99%;' rows=2 name='Medications' placeholder='Current Medication " + h +"'></textarea></td>" +
                                          "<td><textarea id='curMedTable" + h + "Col2' style='width: 99%;' rows=2 name='Medications Dosage' placeholder='Example Dosage " + h +"></textarea></td>"+
                                          "<td><textarea id='curMedTable" + h + "Col3' style='width: 99%;' rows=2 name='Medications Frequency' placeholder='Example Frequency " + h +"'></textarea></td>"+
                                          "</tr>" );}
     }
     else if(y == x){}
     else{
       var z = y-x;
       for(var i=0; i < z; i++){
         $("#medicationsTable tr:last").remove();
       }
     }
   });
   //Current Supplements Table
   $("#curVitTableLengthConfirm").click(function(){
     var x = $("#curVitTableLength").val()
     var y = $("#vitaminsTable tr").length - 1;
     if(y < x){
       var z = x-y;
       for(var i = 0; i< z; i++){
       var h = $("#vitaminsTable tr").length;
       $('#vitaminsTable tr:last').after("<tr><td>" + h + "</td>"+
                                          "<td><textarea id='curVitTable" + h + "Col1' style='width: 99%;' rows=2 name='Vitamins' placeholder='Current Vitamin/Mineral/Supplement " + h +"'></textarea></td>" +
                                          "<td><textarea id='curVitTable" + h + "Col2' style='width: 99%;' rows=2 name='Vitamins Dosage' placeholder='Example Dosage " + h +"'></textarea></td>"+
                                          "<td><textarea id='curVitTable" + h + "Col3' style='width: 99%;' rows=2 name='Vitamins Frequency' placeholder='Example Frequency " + h +"'></textarea></td>"+
                                          "</tr>" );}
     }
     else if(y == x){}
     else{
       var z = y-x;
       for(var i=0; i < z; i++){
         $("#vitaminsTable tr:last").remove();
       }
     }
   });
 
   $("#medTableAdd").click(function(){
     var i = $('#medTable tr').length;
     $('#medTable tr:last').after("<tr><td>" + i + "</td>"+
                                           "<td><textarea id='medTable" + i + "' style='width: 99%;' rows=2 name='Medical Condition/Diagnosis' placeholder='Medical Condition/Diagnosis " + i +"'></textarea></td></tr>" );
   });
   
   $("#medTableMinus").click(function() {
     if($('#medTable tr').length > 2){
       $("#medTable tr:last").remove();
     }
    });
    
    
    
    
    
    //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    //-------------------------------Current Medication-----------------------------
    //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>


   $("#curMedTableAdd").click(function(){
     var i = $('#medicationsTable tr').length;
     $('#medicationsTable tr:last').after("<tr><td>" + i + "</td>"+
                                          "<td><textarea id='curMedTable" + i + "Col1' style='width: 99%;' rows=2 name='Medications'> Current Medication " + i +"</textarea></td>" +
                                          "<td><textarea id='curMedTable" + i + "Col2' style='width: 99%;' rows=2 name='Medications Dosage'> Example Dosage " + i +"</textarea></td>"+
                                          "<td><textarea id='curMedTable" + i + "Col3' style='width: 99%;' rows=2 name='Medications Frequency'> Example Frequency " + i +"</textarea></td>"+
                                          "</tr>" );
     });



   $("#curMedTableMinus").click(function() {
     if($('#medicationsTable tr').length > 1){
       $("#medicationsTable tr:last").remove();
     }
    });

    
    
    
    
    //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    //-------------------------------Current Vitamins-----------------------------
    //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>


   $("#curVitTableAdd").click(function(){
     var i = $('#vitaminsTable tr').length;
     $('#vitaminsTable tr:last').after("<tr><td>" + i + "</td>"+
                                          "<td><textarea id='curVitTable" + i + "Col1' style='width: 99%;' rows=2 name='Vitamins'> Current Vitamin/Mineral/Supplement " + i +"</textarea></td>" +
                                          "<td><textarea id='curVitTable" + i + "Col2' style='width: 99%;' rows=2 name='Vitamins Dosage'> Example Dosage " + i +"</textarea></td>"+
                                          "<td><textarea id='curVitTable" + i + "Col3' style='width: 99%;' rows=2 name='Vitamins Frequency'> Example Frequency " + i +"</textarea></td>"+
                                          "</tr>" );
     });

   $("#curVitTableMinus").click(function() {
     if($('#vitaminsTable tr').length > 1){
       $("#vitaminsTable tr:last").remove();
     }
    });
  
    
    
    //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    //-----------------------------------Allergies----------------------------------
    //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    
   $("#allergiesTableAdd").click(function(){
     var i = $('#allergiesTable tr').length;
     $('#allergiesTable tr:last').after("<tr><td>" + i + "</td>"+
                                           "<td><textarea id='allergiesTable" + i + "' style='width: 99%;' rows=2 name='Allergies'> Allergy " + i +"</textarea></td></tr>" );
   });
 
   $("#allergiesTableMinus").click(function() {
     if($('#allergiesTable tr').length > 1){
       $("#allergiesTable tr:last").remove();
     }
    });
    
    
    
    //=================================================================================================================================================================
    //-------------------------------------------------Current and Past Services Page----------------------------------------------------------------------------------
    //=================================================================================================================================================================
    
    //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    //----------------------------------EITrue -------------------------------------
    //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    
     
    $("#EIYes").click(function(){
      if($('#EIYes').is(':checked')){ 
        $("#EITrue").show()
        $("#EITrue2").show();        
      }
    });
    $("#EINo").click(function(){
      if($('#EINo').is(':checked')){ 
        $("#EITrue").hide();
        $("#EITrue2").hide();
        while($("#IFSPTable tr").length != 1){
          $("#IFSPTable tr:last").remove();
          }
        }
    });
  
  
  
  //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
  //---------------------------------EITrue1 Table--------------------------------
  //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
     
   $("#IFSPTableAdd").click(function(){
     var i = $('#IFSPTable tr').length;
     $('#IFSPTable tr:last').after(     
                                   "<tr>"+
                                   "<td><textarea id='IFSPTable"+i+"Col1'  style='width: 99%;' rows=2 placeholder='EI Service/Method' name='PastEIService'></textarea></td>" +
                                   "<td><textarea id='IFSPTable"+i+"Col2'  style='width: 99%;' rows=2 placeholder='Provider' name='PastEIProvider'         ></textarea></td>" +
                                   "<td><textarea id='IFSPTable"+i+"Col3'  style='width: 99%;' rows=2 placeholder='Location' name='PastEILocation'         ></textarea></td>" +
                                   "<td><textarea id='IFSPTable"+i+"Col4'  style='width: 99%;' rows=2 placeholder='Frequency/Length' name='PastEIFrequency' ></textarea></td>" +
                                   "<td><textarea id='IFSPTable"+i+"Col5'  style='width: 99%;' rows=2 placeholder='Intensity' name='PastEIIntesity'        ></textarea></td>" +
                                   "<td><textarea id='IFSPTable"+i+"Col6'  style='width: 99%;' rows=2 placeholder='Duration' name='PastEIDuration'         ></textarea></td>" +
                                   "<td><textarea id='IFSPTable"+i+"Col7'  style='width: 99%;' rows=2 placeholder='Start Date' name='PastEIStart'       ></textarea></td>" +
                                   "<td><textarea id='IFSPTable"+i+"Col8'  style='width: 99%;' rows=2 placeholder='End Date' name='PastEIEnd'         ></textarea></td>"+
                                   "</tr>"
                                    );
   });
 
   $("#IFSPTableMinus").click(function() {
     if($('#IFSPTable tr').length > 1){
       $("#IFSPTable tr:last").remove();
     }
    });
    
    
    //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    //----------------------------------OSEITrue -------------------------------------
    //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
     
     
    $("#OSEIYes").click(function(){
      if($('#OSEIYes').is(':checked')){ 
        $("#OSEITrue").show();        
      }
    });
    $("#OSEINo").click(function(){
      if($('#OSEINo').is(':checked')){ 
        $("#OSEITrue").hide();
        while($("#OSEITable tr").length != 1){
          $("#OSEITable tr:last").remove();
          }
        }
    });
  
  
  //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
  //---------------------------------OSEITrue Table--------------------------------
  //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
     
   $("#OSEITableAdd").click(function(){
     var i = $('#OSEITable tr').length;
     $('#OSEITable tr:last').after(     
                                   "<tr>"+
                                   "<td><textarea id='OSEITable"+i+"Col1'  style='width: 99%;' rows=2 placeholder='Treatment Service' name='OSEI Service' ></textarea></td>" +
                                   "<td><textarea id='OSEITable"+i+"Col2'  style='width: 99%;' rows=2 placeholder='SessionDuration' name='OSEI Duration'  ></textarea></td>" +
                                   "<td><textarea id='OSEITable"+i+"Col3'  style='width: 99%;' rows=2 placeholder='Frequency' name='OSEI Frequency'       ></textarea></td>" +
                                   "<td><textarea id='OSEITable"+i+"Col4'  style='width: 99%;' rows=2 placeholder='Location' name='OSEI Location'         ></textarea></td>" +
                                   "<td><textarea id='OSEITable"+i+"Col5'  style='width: 99%;' rows=2 placeholder='Start Date' name='OSEI Start Date'     ></textarea></td>" +
                                   "<td><textarea id='OSEITable"+i+"Col6'  style='width: 99%;' rows=2 placeholder='End Date' name='OSEI End Date'         ></textarea></td>"+
                                   "</tr>"
                                    );
   });
 
   $("#OSEITableMinus").click(function() {
     if($('#OSEITable tr').length > 1){
       $("#OSEITable tr:last").remove();
     }
    });


     //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
     //----------------------------------CEITrue -------------------------------------
     //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
     
     
    $("#CEIYes").click(function(){
      if($('#CEIYes').is(':checked')){ 
        $("#CEITrue").show()
        $("#CEITrue2").show();        
      }
    });
    $("#CEINo").click(function(){
      if($('#CEINo').is(':checked')){ 
        $("#CEITrue").hide();
        $("#CEITrue2").hide();
        while($("#CEITable tr").length != 1){
          $("#CEITable tr:last").remove();
          }
        }
    });
    
   
   
   
        //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
     //---------------------------------OSEITrue Table--------------------------------
     //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
     
   $("#CEITableAdd").click(function(){
     var i = $('#CEITable tr').length;
     $('#CEITable tr:last').after(     
                                   "<tr>"+
                                   "<td><textarea id='CEITable"+i+"Col1'  style='width: 99%;' rows=2 placeholder='EI Service/Method'name='CEI Service' ></textarea></td>" +
                                   "<td><textarea id='CEITable"+i+"Col2'  style='width: 99%;' rows=2 placeholder='Provider'         name='CEI Provider' ></textarea></td>" +
                                   "<td><textarea id='CEITable"+i+"Col3'  style='width: 99%;' rows=2 placeholder='Location'         name='CEI Location' ></textarea></td>" +
                                   "<td><textarea id='CEITable"+i+"Col4'  style='width: 99%;' rows=2 placeholder='Frequency/Length' name='CEI Frequency'></textarea></td>" +
                                   "<td><textarea id='CEITable"+i+"Col5'  style='width: 99%;' rows=2 placeholder='Intensity'        name='CEI Intensity' ></textarea></td>" +
                                   "<td><textarea id='CEITable"+i+"Col6'  style='width: 99%;' rows=2 placeholder='Duration'         name='CEI Duration' ></textarea></td>" +
                                   "<td><textarea id='CEITable"+i+"Col7'  style='width: 99%;' rows=2 placeholder='Start Date'       name='CEI Start' ></textarea></td>" +
                                   "<td><textarea id='CEITable"+i+"Col8'  style='width: 99%;' rows=2 placeholder='End Date'         name='CEI End' ></textarea></td>"+
                                   "</tr>"
                                    );
   });
 
   $("#CEITableMinus").click(function() {
     if($('#CEITable tr').length > 1){
       $("#CEITable tr:last").remove();
     }
    });




     //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
     //--------------------------------- School -------------------------------------
     //>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
     
     
    $("#schoolYes").click(function(){
      if($('#schoolYes').is(':checked')){ 
          $("#schoolTrue").show();
      }
    });
    $("#schoolNo").click(function(){
      if($('#schoolNo').is(':checked')){ 
        $("#schoolTrue").hide();
        $("#isIEPTrue").hide();
        $("#is504True").hide();
        $("#isEvalTrue").hide();
        }
    });
  });

 

  
  //For event handling dynamically added elements : https://stackoverflow.com/questions/12055462/handle-click-event-for-appended-elements-in-jquery
  $(document).on('click', '#notIEP504', function(){ 
    if($('#notIEP504').is(':checked')){ 
        $("#isIEPTrue").hide();
        $("#is504True").hide();    
        $("#isEvalTrue").hide();    
     }
}); 

  $(document).on('click', '#is504', function(){ 
    if($('#is504').is(':checked')){ 
        $("#is504True").show();
        $("#isIEPTrue").hide();
        $("#isEvalTrue").hide();        
     }
}); 

$(document).on('click', '#isIEP', function(){ 
    if($('#isIEP').is(':checked')){ 
        $("#isIEPTrue").show()
        $("#is504True").hide();
        $("#isEvalTrue").hide();        
     }
}); 

$(document).on('click', '#isEval', function(){ 
    if($('#isEval').is(':checked')){ 
        $("#isEvalTrue").show();
        $("#is504True").hide();
        $("#isIEPTrue").hide();
     }
}); 


/*
 *  Function parse file inputs and upload to drive after reader is finished
 */

function fileReportUpload(x, container,image){
  readReportURL(x, image);
  
  var txt = "";
  if ('files' in x) {
    if (x.files.length == 0) {
      txt = "Select one or more files.";
    } else {
      for (var i = 0; i < x.files.length; i++) {
        txt += "<br><strong>" + (i+1) + ". file</strong><br>";
        var file = x.files[i];
        if ('name' in file) {
          txt += "name: " + file.name + "<br>";
        }
        if ('size' in file) {
          txt += "size: " + file.size + " bytes <br>";
        }
      }
    }
  } 
  else {
    if (x.value == "") {
      txt += "Select one or more files.";
    } else {
      txt += "The files property is not supported by your browser!";
      txt  += "<br>The path of the selected file: " + x.value; // If the browser does not support the files property, it will return the path of the selected file instead. 
    }
  }
  document.getElementById(container).innerHTML = txt;
}
  
function readReportURL(input, container) {
  if (input.files && input.files[0]) {
    var reader = new FileReader();
    
    reader.onload = function(e) {
      $('#'+container).attr('src', e.target.result);
    }
    
    reader.readAsDataURL(input.files[0]); // convert to base64 string
  }
}

</script>